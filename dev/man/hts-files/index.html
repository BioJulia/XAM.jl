<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SAM and BAM · XAM.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="XAM.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">XAM.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>SAM and BAM</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Reading-SAM-and-BAM-files"><span>Reading SAM and BAM files</span></a></li><li><a class="tocitem" href="#SAM-and-BAM-Headers"><span>SAM and BAM Headers</span></a></li><li><a class="tocitem" href="#SAM-and-BAM-Records"><span>SAM and BAM Records</span></a></li><li><a class="tocitem" href="#Accessing-auxiliary-data"><span>Accessing auxiliary data</span></a></li><li><a class="tocitem" href="#Getting-records-in-a-range"><span>Getting records in a range</span></a></li><li><a class="tocitem" href="#Getting-records-overlapping-genomic-features"><span>Getting records overlapping genomic features</span></a></li><li><a class="tocitem" href="#Writing-files"><span>Writing files</span></a></li></ul></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>SAM and BAM</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SAM and BAM</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/BioJulia/XAM.jl/blob/develop/docs/src/man/hts-files.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="SAM-and-BAM"><a class="docs-heading-anchor" href="#SAM-and-BAM">SAM and BAM</a><a id="SAM-and-BAM-1"></a><a class="docs-heading-anchor-permalink" href="#SAM-and-BAM" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>The <code>XAM</code> package offers high-performance tools for SAM and BAM file formats, which are the most popular file formats.</p><p>If you have questions about the SAM and BAM formats or any of the terminology used when discussing these formats, see the published <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">specification</a>, which is maintained by the <a href="https://samtools.github.io/">samtools group</a>.</p><p>A very very simple SAM file looks like the following:</p><pre><code class="nohighlight hljs">@HD VN:1.6 SO:coordinate
@SQ SN:ref LN:45
r001   99 ref  7 30 8M2I4M1D3M = 37  39 TTAGATAAAGGATACTG *
r002    0 ref  9 30 3S6M1P1I4M *  0   0 AAAAGATAAGGATA    *
r003    0 ref  9 30 5S6M       *  0   0 GCCTAAGCTAA       * SA:Z:ref,29,-,6H5M,17,0;
r004    0 ref 16 30 6M14N5M    *  0   0 ATAGCTTCAGC       *
r003 2064 ref 29 17 6H5M       *  0   0 TAGGC             * SA:Z:ref,9,+,5S6M,30,1;
r001  147 ref 37 30 9M         =  7 -39 CAGCGGCAT         * NM:i:1</code></pre><p>Where the first two lines are part of the &quot;header&quot;, and the following lines are &quot;records&quot;. Each record describes how a read aligns to some reference sequence. Sometimes one record describes one read, but there are other cases like chimeric reads and split alignments, where multiple records apply to one read. In the example above, <code>r003</code> is a chimeric read, and <code>r004</code> is a split alignment, and <code>r001</code> are mate pair reads. Again, we refer you to the official <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">specification</a> for more details.</p><p>A BAM file stores this same information but in a binary and compressible format that does not make for pretty printing here!</p><h2 id="Reading-SAM-and-BAM-files"><a class="docs-heading-anchor" href="#Reading-SAM-and-BAM-files">Reading SAM and BAM files</a><a id="Reading-SAM-and-BAM-files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-SAM-and-BAM-files" title="Permalink"></a></h2><p>A typical script iterating over all records in a file looks like below:</p><pre><code class="language-julia hljs">using XAM

# Open a BAM file.
reader = open(BAM.Reader, &quot;data.bam&quot;)

# Iterate over BAM records.
for record in reader
    # `record` is a BAM.Record object.
    if BAM.ismapped(record)
        # Print the mapped position.
        println(BAM.refname(record), &#39;:&#39;, BAM.position(record))
    end
end

# Close the BAM file.
close(reader)</code></pre><p>The size of a BAM file is often extremely large. The iterator interface demonstrated above allocates an object for each record and that may be a bottleneck of reading data from a BAM file. In-place reading reuses a pre-allocated object for every record and less memory allocation happens in reading:</p><pre><code class="language-julia hljs">reader = open(BAM.Reader, &quot;data.bam&quot;)
record = BAM.Record()
while !eof(reader)
    empty!(record)
    read!(reader, record)
    # do something
end</code></pre><h2 id="SAM-and-BAM-Headers"><a class="docs-heading-anchor" href="#SAM-and-BAM-Headers">SAM and BAM Headers</a><a id="SAM-and-BAM-Headers-1"></a><a class="docs-heading-anchor-permalink" href="#SAM-and-BAM-Headers" title="Permalink"></a></h2><p>Both <code>SAM.Reader</code> and <code>BAM.Reader</code> implement the <code>header</code> function, which returns a <code>SAM.Header</code> object. To extract certain information out of the headers, you can use the <code>findall</code> method on the header to extract information according to SAM/BAM tag. Again we refer you to the <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">specification</a> for full details of all the different tags that can occur in headers, and what they mean.</p><p>Below is an example of extracting all the info about the reference sequences from the BAM header. In SAM/BAM, any description of a reference sequence is stored in the header, under a tag denoted <code>SQ</code> (think <code>reference SeQuence</code>!).</p><pre><code class="language-jlcon hljs">julia&gt; reader = open(SAM.Reader, &quot;data.sam&quot;);

julia&gt; findall(SAM.header(reader), &quot;SQ&quot;)
7-element Array{Bio.Align.SAM.MetaInfo,1}:
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=Chr1 LN=30427671
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=Chr2 LN=19698289
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=Chr3 LN=23459830
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=Chr4 LN=18585056
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=Chr5 LN=26975502
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=chloroplast LN=154478
 Bio.Align.SAM.MetaInfo:
    tag: SQ
  value: SN=mitochondria LN=366924
</code></pre><p>In the above we can see there were 7 sequences in the reference: 5 chromosomes, one chloroplast sequence, and one mitochondrial sequence.</p><h2 id="SAM-and-BAM-Records"><a class="docs-heading-anchor" href="#SAM-and-BAM-Records">SAM and BAM Records</a><a id="SAM-and-BAM-Records-1"></a><a class="docs-heading-anchor-permalink" href="#SAM-and-BAM-Records" title="Permalink"></a></h2><h3 id="SAM.Record"><a class="docs-heading-anchor" href="#SAM.Record">SAM.Record</a><a id="SAM.Record-1"></a><a class="docs-heading-anchor-permalink" href="#SAM.Record" title="Permalink"></a></h3><p>The <code>XAM</code> package supports the following accessors for <code>SAM.Record</code> types.</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>XAM.SAM.flags</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="XAM.ismapped" href="#XAM.ismapped"><code>XAM.ismapped</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ismapped(record::XAMRecord)::Bool</code></pre><p>Query whether the segment is mapped.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/flags.jl#L86-L90">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.isprimaryalignment" href="#XAM.isprimaryalignment"><code>XAM.isprimaryalignment</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">isprimaryalignment(record::XAMRecord)::Bool</code></pre><p>Query whether the read alignment is considered to be the primary alignment. This is primary line of the read and is equivalent to <code>flags(record) &amp; 0x900 == 0</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/flags.jl#L242-L247">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.refname" href="#XAM.SAM.refname"><code>XAM.SAM.refname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">refname(record::Record)::String</code></pre><p>Get the reference sequence name of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L162-L166">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.position" href="#XAM.SAM.position"><code>XAM.SAM.position</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">position(record::Record)::Int</code></pre><p>Get the 1-based leftmost mapping position of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L179-L183">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.rightposition" href="#XAM.SAM.rightposition"><code>XAM.SAM.rightposition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rightposition(record::Record)::Int</code></pre><p>Get the 1-based rightmost mapping position of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L197-L201">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.isnextmapped" href="#XAM.isnextmapped"><code>XAM.isnextmapped</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">isnextmapped(record::XAMRecord)::Bool</code></pre><p>Query whether the next segment in the template is mapped.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/flags.jl#L105-L109">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.nextrefname" href="#XAM.SAM.nextrefname"><code>XAM.SAM.nextrefname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nextrefname(record::Record)::String</code></pre><p>Get the reference name of the mate/next read of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L210-L214">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.nextposition" href="#XAM.SAM.nextposition"><code>XAM.SAM.nextposition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nextposition(record::Record)::Int</code></pre><p>Get the position of the mate/next read of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L227-L231">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.mappingquality" href="#XAM.SAM.mappingquality"><code>XAM.SAM.mappingquality</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mappingquality(record::Record)::UInt8</code></pre><p>Get the mapping quality of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L245-L249">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.cigar" href="#XAM.SAM.cigar"><code>XAM.SAM.cigar</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cigar(record::Record)::String</code></pre><p>Get the CIGAR string of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L263-L267">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.alignment" href="#XAM.SAM.alignment"><code>XAM.SAM.alignment</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">alignment(record::Record)::BioAlignments.Alignment</code></pre><p>Get the alignment of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L281-L285">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.alignlength" href="#XAM.SAM.alignlength"><code>XAM.SAM.alignlength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">alignlength(record::Record)::Int</code></pre><p>Get the alignment length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L299-L303">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.tempname" href="#XAM.SAM.tempname"><code>XAM.SAM.tempname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">tempname(record::Record)::String</code></pre><p>Get the query template name of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L325-L329">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.templength" href="#XAM.SAM.templength"><code>XAM.SAM.templength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">templength(record::Record)::Int</code></pre><p>Get the template length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L342-L346">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.sequence" href="#XAM.SAM.sequence"><code>XAM.SAM.sequence</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">sequence(record::Record)::BioSequences.LongDNA{4}</code></pre><p>Get the segment sequence of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L360-L364">source</a></section><section><div><pre><code class="language-julia hljs">sequence(::Type{String}, record::Record)::String</code></pre><p>Get the segment sequence of <code>record</code> as <code>String</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L380-L384">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.seqlength" href="#XAM.SAM.seqlength"><code>XAM.SAM.seqlength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">seqlength(record::Record)::Int</code></pre><p>Get the sequence length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L390-L394">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.quality" href="#XAM.SAM.quality"><code>XAM.SAM.quality</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">quality(record::Record)::Vector{UInt8}</code></pre><p>Get the Phred-scaled base quality of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L407-L411">source</a></section><section><div><pre><code class="language-julia hljs">quality(::Type{String}, record::Record)::String</code></pre><p>Get the ASCII-encoded base quality of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L428-L432">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.SAM.auxdata" href="#XAM.SAM.auxdata"><code>XAM.SAM.auxdata</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">auxdata(record::Record)::Dict{String,Any}</code></pre><p>Get the auxiliary data (optional fields) of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/sam/record.jl#L438-L442">source</a></section></article><h3 id="BAM.Record"><a class="docs-heading-anchor" href="#BAM.Record">BAM.Record</a><a id="BAM.Record-1"></a><a class="docs-heading-anchor-permalink" href="#BAM.Record" title="Permalink"></a></h3><p>The <code>XAM</code> package supports the following accessors for <code>BAM.Record</code> types.</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>XAM.BAM.flags</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>XAM.BAM.ismapped</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>XAM.BAM.isprimaryalignment</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.refid" href="#XAM.BAM.refid"><code>XAM.BAM.refid</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">refid(record::Record)::Int</code></pre><p>Get the reference sequence ID of <code>record</code>.</p><p>The ID is 1-based (i.e. the first sequence is 1) and is 0 for a record without a mapping position.</p><p>See also: <code>BAM.rname</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L140-L148">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.refname" href="#XAM.BAM.refname"><code>XAM.BAM.refname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">refname(record::Record)::String</code></pre><p>Get the reference sequence name of <code>record</code>.</p><p>See also: <code>BAM.refid</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L169-L175">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.reflen" href="#XAM.BAM.reflen"><code>XAM.BAM.reflen</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reflen(record::Record)::Int</code></pre><p>Get the length of the reference sequence this record applies to.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L182-L186">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.position" href="#XAM.BAM.position"><code>XAM.BAM.position</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">position(record::Record)::Int</code></pre><p>Get the 1-based leftmost mapping position of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L197-L201">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.rightposition" href="#XAM.BAM.rightposition"><code>XAM.BAM.rightposition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rightposition(record::Record)::Int</code></pre><p>Get the 1-based rightmost mapping position of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L211-L215">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>XAM.BAM.isnextmapped</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.nextrefid" href="#XAM.BAM.nextrefid"><code>XAM.BAM.nextrefid</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nextrefid(record::Record)::Int</code></pre><p>Get the next/mate reference sequence ID of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L225-L229">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.nextrefname" href="#XAM.BAM.nextrefname"><code>XAM.BAM.nextrefname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nextrefname(record::Record)::String</code></pre><p>Get the reference name of the mate/next read of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L239-L243">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.nextposition" href="#XAM.BAM.nextposition"><code>XAM.BAM.nextposition</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">nextposition(record::Record)::Int</code></pre><p>Get the 1-based leftmost mapping position of the next/mate read of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L259-L263">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.mappingquality" href="#XAM.BAM.mappingquality"><code>XAM.BAM.mappingquality</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mappingquality(record::Record)::UInt8</code></pre><p>Get the mapping quality of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L273-L277">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.cigar" href="#XAM.BAM.cigar"><code>XAM.BAM.cigar</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cigar(record::Record)::String</code></pre><p>Get the CIGAR string of <code>record</code>.</p><p>Note that in the BAM specification, the field called <code>cigar</code> typically stores the cigar string of the record. However, this is not always true, sometimes the true cigar is very long, and due to  some constraints of the BAM format, the actual cigar string is stored in an extra tag: <code>CG:B,I</code>, and the <code>cigar</code> field stores a pseudo-cigar string.</p><p>Calling this method with <code>checkCG</code> set to <code>true</code> (default) this method will always yield the true cigar string, because this is probably what you want the vast majority of the time.</p><p>If you have a record that stores the true cigar in a <code>CG:B,I</code> tag, but you still want to access the pseudo-cigar that is stored in the <code>cigar</code> field of the BAM record, then you can set checkCG to <code>false</code>.</p><p>See also <code>BAM.cigar_rle</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L302-L315">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.alignment" href="#XAM.BAM.alignment"><code>XAM.BAM.alignment</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">alignment(record::Record)::BioAlignments.Alignment</code></pre><p>Get the alignment of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L387-L391">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.alignlength" href="#XAM.BAM.alignlength"><code>XAM.BAM.alignlength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">alignlength(record::Record)::Int</code></pre><p>Get the alignment length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L404-L408">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.tempname" href="#XAM.BAM.tempname"><code>XAM.BAM.tempname</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">tempname(record::Record)::String</code></pre><p>Get the query template name of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L422-L426">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.templength" href="#XAM.BAM.templength"><code>XAM.BAM.templength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">templength(record::Record)::Int</code></pre><p>Get the template length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L437-L441">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.sequence" href="#XAM.BAM.sequence"><code>XAM.BAM.sequence</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">sequence(record::Record)::BioSequences.LongDNA{4}</code></pre><p>Get the segment sequence of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L451-L455">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.seqlength" href="#XAM.BAM.seqlength"><code>XAM.BAM.seqlength</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">seqlength(record::Record)::Int</code></pre><p>Get the sequence length of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L476-L480">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.quality" href="#XAM.BAM.quality"><code>XAM.BAM.quality</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">quality(record::Record)</code></pre><p>Get the base quality of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L490-L494">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="XAM.BAM.auxdata" href="#XAM.BAM.auxdata"><code>XAM.BAM.auxdata</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">auxdata(record::Record)::BAM.AuxData</code></pre><p>Get the auxiliary data of <code>record</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/BioJulia/XAM.jl/blob/c9f2e64852359cca815daafcc7ac93f10a238e9b/src/bam/record.jl#L506-L510">source</a></section></article><h2 id="Accessing-auxiliary-data"><a class="docs-heading-anchor" href="#Accessing-auxiliary-data">Accessing auxiliary data</a><a id="Accessing-auxiliary-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-auxiliary-data" title="Permalink"></a></h2><p>SAM and BAM records support the storing of optional data fields associated with tags.</p><p>Tagged auxiliary data follows a format of <code>TAG:TYPE:VALUE</code>. <code>TAG</code> is a two-letter string, and each tag can only appear once per record. <code>TYPE</code> is a single case-sensetive letter which defined the format of <code>VALUE</code>.</p><table><tr><th style="text-align: right">Type</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right">&#39;A&#39;</td><td style="text-align: right">Printable character</td></tr><tr><td style="text-align: right">&#39;i&#39;</td><td style="text-align: right">Signed integer</td></tr><tr><td style="text-align: right">&#39;f&#39;</td><td style="text-align: right">Single-precision floating number</td></tr><tr><td style="text-align: right">&#39;Z&#39;</td><td style="text-align: right">Printable string, including space</td></tr><tr><td style="text-align: right">&#39;H&#39;</td><td style="text-align: right">Byte array in Hex format</td></tr><tr><td style="text-align: right">&#39;B&#39;</td><td style="text-align: right">Integer of numeric array</td></tr></table><p>For more information about these tags and their types we refer you to the <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">SAM/BAM specification</a> and the additional <a href="https://samtools.github.io/hts-specs/SAMtags.pdf">optional fields specification</a> document.</p><p>There are some tags that are reserved, predefined standard tags, for specific uses.</p><p>To access optional fields stored in tags, you use <code>getindex</code> indexing syntax on the record object. Note that accessing optional tag fields will result in type instability in Julia. This is because the type of the optional data is not known until run-time, as the tag is being read. This can have a significant impact on performance. To limit this, if the user knows the type of a value in advance, specifying it as a type annotation will alleviate the problem:</p><p>Below is an example of looping over records in a bam file and using indexing syntax to get the data stored in the &quot;NM&quot; tag. Note the <code>UInt8</code> type assertion to alleviate type instability.</p><pre><code class="language-julia hljs">for record in open(BAM.Reader, &quot;data.bam&quot;)
    nm = record[&quot;NM&quot;]::UInt8
    # do something
end</code></pre><h2 id="Getting-records-in-a-range"><a class="docs-heading-anchor" href="#Getting-records-in-a-range">Getting records in a range</a><a id="Getting-records-in-a-range-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-records-in-a-range" title="Permalink"></a></h2><p>The <code>XAM</code> package supports the BAI index to fetch records in a specific range from a BAM file. <a href="https://samtools.github.io/">Samtools</a> provides <code>index</code> subcommand to create an index file (.bai) from a sorted BAM file.</p><pre><code class="language-console hljs">$ samtools index -b SRR1238088.sort.bam
$ ls SRR1238088.sort.bam*
SRR1238088.sort.bam     SRR1238088.sort.bam.bai</code></pre><p>The method <code>eachoverlap(reader, chrom, range)</code> returns an iterator of BAM records overlapping the query interval:</p><pre><code class="language-julia hljs">reader = open(BAM.Reader, &quot;SRR1238088.sort.bam&quot;, index=&quot;SRR1238088.sort.bam.bai&quot;)
for record in eachoverlap(reader, &quot;Chr2&quot;, 10000:11000)
    # `record` is a BAM.Record object
    # ...
end
close(reader)</code></pre><h2 id="Getting-records-overlapping-genomic-features"><a class="docs-heading-anchor" href="#Getting-records-overlapping-genomic-features">Getting records overlapping genomic features</a><a id="Getting-records-overlapping-genomic-features-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-records-overlapping-genomic-features" title="Permalink"></a></h2><p>The <code>eachoverlap</code> method also accepts the <code>Interval</code> type defined in <a href="https://github.com/BioJulia/GenomicFeatures.jl">GenomicFeatures.jl</a>.</p><p>This allows you to do things like first read in the genomic features from a GFF3 file, and then for each feature, iterate over all the BAM records that overlap with that feature.</p><pre><code class="language-julia hljs">using GenomicFeatures
using GFF3
using XAM

# Load genomic features from a GFF3 file.
features = open(collect, GFF3.Reader, &quot;TAIR10_GFF3_genes.gff&quot;)

# Keep mRNA features.
filter!(x -&gt; GFF3.featuretype(x) == &quot;mRNA&quot;, features)

# Open a BAM file and iterate over records overlapping mRNA transcripts.
reader = open(BAM.Reader, &quot;SRR1238088.sort.bam&quot;, index = &quot;SRR1238088.sort.bam.bai&quot;)
for feature in features
    for record in eachoverlap(reader, feature)
        # `record` overlaps `feature`.
        # ...
    end
end
close(reader)</code></pre><h2 id="Writing-files"><a class="docs-heading-anchor" href="#Writing-files">Writing files</a><a id="Writing-files-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-files" title="Permalink"></a></h2><p>In order to write a BAM or SAM file, you must first create a <code>SAM.Header</code>.</p><p>A <code>SAM.Header</code> is constructed from a vector of <code>SAM.MetaInfo</code> objects.</p><p>For example, to create the following simple header:</p><pre><code class="nohighlight hljs">@HD VN:1.6 SO:coordinate
@SQ SN:ref LN:45</code></pre><pre><code class="language-julia hljs">julia&gt; a = SAM.MetaInfo(&quot;HD&quot;, [&quot;VN&quot; =&gt; 1.6, &quot;SO&quot; =&gt; &quot;coordinate&quot;])
SAM.MetaInfo:
    tag: HD
  value: VN=1.6 SO=coordinate

julia&gt; b = SAM.MetaInfo(&quot;SQ&quot;, [&quot;SN&quot; =&gt; &quot;ref&quot;, &quot;LN&quot; =&gt; 45])
SAM.MetaInfo:
    tag: SQ
  value: SN=ref LN=45

julia&gt; h = SAM.Header([a, b])
SAM.Header(SAM.MetaInfo[SAM.MetaInfo:
    tag: HD
  value: VN=1.6 SO=coordinate, SAM.MetaInfo:
    tag: SQ
  value: SN=ref LN=45])
</code></pre><p>Then to create the writer for a SAM file, construct a <code>SAM.Writer</code> using the header and an <code>IO</code> type:</p><pre><code class="language-julia hljs">julia&gt; samw = SAM.Writer(open(&quot;my-data.sam&quot;, &quot;w&quot;), h)
SAM.Writer(IOStream(&lt;file my-data.sam&gt;))
</code></pre><p>To make a BAM Writer is slightly different, as you need to use a specific stream type from the <a href="https://github.com/BioJulia/BGZFStreams.jl">https://github.com/BioJulia/BGZFStreams.jl</a> package:</p><pre><code class="language-julia hljs">julia&gt; using BGZFStreams

julia&gt; bamw = BAM.Writer(BGZFStream(open(&quot;my-data.bam&quot;, &quot;w&quot;), &quot;w&quot;))
BAM.Writer(BGZFStreams.BGZFStream{IOStream}(&lt;mode=write&gt;))
</code></pre><p>Once you have a BAM or SAM writer, you can use the <code>write</code> method to write <code>BAM.Record</code>s or <code>SAM.Record</code>s to file:</p><pre><code class="language-julia hljs">julia&gt; write(bamw, rec) # Here rec is a `BAM.Record`
330780</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../api/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 27 January 2024 08:11">Saturday 27 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
